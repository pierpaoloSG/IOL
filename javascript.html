<script>

function start(){ 
    console.log('start')
    createTableFiles()
    createTableDiffide()
}


$(document).ready(function(){

//controlla il click su tableFilesHeader

      $("#tableFilesHeader" ).on('click', function(){  
      var $table = $("#tableFiles")
      var $checkAll = $("#tableFilesHeader").find(".checkAll")
      var $checkSingles = $table.find("input[type=checkbox]").not(".checkAll")
      var $checkSinglesVisible = $checkSingles.not(":hidden")
      var $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
      var $checkSinglesCheckedVisible = $checkSinglesChecked.not(":hidden")
      var $notChecked = $checkSingles.not(":checked");
      
      //gestisce il change di checkAll
      $checkAll.change(function () {
      $checkSingles.each(function() {
            $(this).prop("checked", $checkAll.prop("checked"));
        })
      
      $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
     
      if ( $checkSinglesChecked.length >0){
          $("#import").prop("disabled", false)
      }
      else
      {
          $("#import").prop("disabled", true)
       
      }
      
         $("#filesChecked").html($checkSinglesChecked.length)
      })
      
  })
         
//controlla il click su tableFiles

      $("#tableFiles" ).on('click', function(){  
      var $table = $(this)
      var $checkAll = $("#tableFilesHeader").find(".checkAll")
      var $checkSingles = $table.find("input[type=checkbox]").not(".checkAll")
      var $checkSinglesVisible = $checkSingles.not(":hidden")
      var $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
      var $checkSinglesCheckedVisible = $checkSinglesChecked.not(":hidden")
      var $notChecked = $checkSingles.not(":checked");
      
      //gestisce il change di checkSingle 
      $checkSingles.change(function () { 
      
      $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
      $checkSinglesVisible = $checkSingles.not(":hidden")
      if ($checkSinglesChecked.length >0){
          $("#import").prop("disabled", false)
      }
      else
      {
          $("#import").prop("disabled", true) 
      }
      $("#filesChecked").html($checkSinglesChecked.length)
      
      if ($checkSinglesChecked.length == $checkSinglesVisible.length){
          $checkAll.prop("checked", true)
      }
      else
      {
         $checkAll.prop("checked", false)
      }

      })
      
   
      })
      
      
      $("#tableDiffide" ).on('click', function(){  
      var $table = $(this)
      var $checkAll = $table.find(".checkAll")
      var $checkSingles = $table.find("input[type=checkbox]").not(".checkAll")
      var $checkSinglesVisible = $checkSingles.not(":hidden")
      var $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
      var $checkSinglesCheckedVisible = $checkSinglesChecked.not(":hidden")
      var $notChecked = $checkSingles.not(":checked");
      
      
      //*****************************************
      //gestisce il change di checkSingle 
      
      $checkSingles.change(function () { 
      $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")
      $checkSinglesVisible = $checkSingles.not(":hidden")
      if ($checkSinglesChecked.length >0){
          $("#print").prop("disabled", false)
          //$("#export").prop("disabled", false) il pulsante esporta è sempre abilitato
      }
      else
      {
          $("#print").prop("disabled", true) 
          //$("#export").prop("disabled", true)  il pulsante esporta è sempre abilitato
      }
      var $checkSinglesCheckedVisible = $checkSinglesChecked.not(":hidden")
      $("#praticheChecked").html($checkSinglesCheckedVisible.length)
      
      
      if ($checkSinglesChecked.length == $checkSinglesVisible.length){
          $checkAll.prop("checked", true)
      }
      else
      {
         $checkAll.prop("checked", false)
      }
      
      })
      
      //*****************************************
      //gestisce il change di checkAll
      $checkAll.change(function () {
      $checkSingles.each(function() {
            $(this).prop("checked", $checkAll.prop("checked"));
        })
      
      var  $checkSinglesChecked = $table.find("input[type=checkbox]:checked").not(".checkAll")

     
      if ( $checkSinglesChecked.length >0){
          $("#print").prop("disabled", false)
          //$("#export").prop("disabled", false)  il pulsante esporta è sempre abilitato
      }
      else
      {
          $("#print").prop("disabled", true)
          //$("#export").prop("disabled", true)  il pulsante esporta è sempre abilitato
       
      }

         $("#praticheChecked").html($checkSinglesChecked.length)
      })
            
      })
      
 // button Filter
        $('.filterable .btn-filter').click(function(){
        
        var $panel = $(this).parents('.filterable'),
        $filters = $panel.find('.filters input'),
        $tbody = $panel.find('.table tbody'),
        $checkboxesChecked = $tbody.find("input[type=checkbox]:checked")
        $("#praticheVisible").html($checkboxesChecked.length)
        console.log( $checkboxesChecked.length)

        if ($filters.prop('disabled') === true) {
            $filters.prop('disabled', false);
            
        } else {
            $filters.val('').prop('disabled', true);
            
            $tbody.find('.no-result').remove();
            $tbody.find('tr').show();
        }
    });


    $('.filterable .filters input').not('#range').keyup(function(e){
        // Ignore tab key 
        var code = e.keyCode || e.which;
        if (code == '9') return;
        // if esc is pressed we want to clear the value of search box
        if (code == 27 || $(this).val() == '') {
        $(this).val('');
        }
        // Useful DOM data and selectors 
        var $input = $(this),
        inputContent = $input.val().toLowerCase(),
        $panel = $input.parents('.filterable'),
        column = $panel.find('.filters th').index($input.parents('th')),
        $table = $panel.find('.table'),
        $rows = $table.find('tbody tr');
        // Dirtiest filter function ever ;) 
        var $filteredRows = $rows.filter(function(){
            var value = $(this).find('td').eq(column).text().toLowerCase();
            return value.indexOf(inputContent) === -1;
        });
        
        // Clean previous no-result if exist 
        $table.find('tbody .no-result').remove();
        // Show all rows, hide filtered ones    
        $rows.show();
        $filteredRows.hide();
        var praticheVisible = $rows.length - $filteredRows.length 
        $("#praticheVisible").html(praticheVisible)
        //Prepend no-result row if all rows are filtered 
        if ($filteredRows.length === $rows.length) {
            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
        }
    }); 



  
  $("#refreshTableFiles").click(function(){
      console.log('aggiorna la tabella')
         var $icon = $('#refreshTableFiles > span');
         $icon.removeClass('glyphicon-repeat')
         $icon.addClass('glyphicon-refresh')
         $icon.addClass('glyphicon-refresh-animate')
         createTableFiles()

  });

   $('#import').on('click', function (e) {
              console.log('import clicked')
              // le checkbox non contengono l'attributo require, quindi il controllo viene fatto qui !
                var min = 1 //minumum number of boxes to be checked for this form-group
                var checkboxes = $(".checkSingle:checkbox:checked")
                if(checkboxes.length < min){
                  console.log('devi selezionare almeno ' + min + ' file/s')
                  return false
                  // è necessario selezionare almeno un file
                }
                  // importa i dati dai file di affido selezionati
                  // gestisce l'animazione dell'icona del button importa
                  var $icon = $( '#import > span' );
                        $icon.removeClass('glyphicon-import')
                        $icon.addClass('glyphicon-refresh')
                        $icon.addClass('glyphicon-refresh-animate')
                 //compone l'array dei files selezionati
                 var files = []
                 var filesObj = {}
                  //var checkboxes = $("input:checkbox:checked");
                  $(checkboxes).each(function(){
                    var url = $(this).closest('tr').find('td').eq(2).html(); 
                    filesObj = {
                    'url':  url
                    }
                    console.filesObj
                    files.push(filesObj) 
                 });
                 
                  //legge i dati dai files di affido selezionati
                  console.log("files " + JSON.stringify(files))
                  $('#outputPanelText').empty()
                  google.script.run
                    .withSuccessHandler(onReadDiffide)
                    .withFailureHandler(onError2)
                    .readDiffideFromFiles(files)    
                  return false
          })
                function onReadDiffide(results){

                    var objDiffideDaInviare = results[0]
                    var dataImportazioneAffido = results[1]
                    var objErrors = results[2]
                    var logRateiFattura = results[3]
                    var outputMessage
                    
                      for (var i=0; i<objErrors.length; i++){
                           outputMessage =+ objErrors[i] + "\n"
                      }
           
                    //$('#outputPanelText').append(outputMessage)
                    // ricrea la tabella dei files aggiornata 
                    createTableFiles() 
                    // crea la tabella diffide
                       var $icon = $('#refreshTableFiles')
                       $icon.removeClass('glyphicon-refresh')
                       $icon.removeClass('glyphicon-refresh-animate')
                       $icon.addClass('glyphicon-import')
                       createTableDiffide(objDiffideDaInviare)
                }
                 
                function onError2(err){ 
                  
                  $('#outputPanelText').append(JSON.stringify(err))
                 }         
 

//********************************************************
  $('#print').on('click', function (e) {
     
      var objDiffide = {
        'Data invio':''}
      var diffide = []
      var checkSinglesVisibleChecked = $("input.checkSingle:visible:checked");
      $(checkSinglesVisibleChecked).each(function(){
            //var selected = $(this).closest('tr').find('td').eq(1).html() 
            if ($(this).closest('tr').find("td").eq(3).html() == ""){
                var toPrint = $(this).closest('tr').find('td').eq(1).html()
                diffide.push(toPrint)
            }
            
      });
      
      objDiffide.diffide = diffide.reverse()
      console.log((objDiffide.diffide).length + ' diffide to print: ' + objDiffide.diffide)
      openDateModal(objDiffide)
      
    })
    
  function openDateModal(objDiffide){
      //$('#outputPanelText').empty() // svuota il pannello risultati
      $('#dateModal').modal('show')
      console.log('dateModal show')
      //$('#formDateModal').validator()
         $("#formDateModal").on('submit', function(e){
                     if (e.isDefaultPrevented()) {
                         // se l'invio del form è stato prevenuto mostra un messaggio ed evita di eseguire le operazioni
                         // che risulterebbero in più
                         console.log('Il form inviato non è valido')
                        
                    } else {
                        $('#dateModal').modal('hide')
                      console.log('print diffide ' + JSON.stringify(objDiffide))
                      objDiffide['Data invio'] = $("#dataInvio").find("input").val()
                      if ($("#checkboxDiffide").is(':checked')){
                            printDiffide(objDiffide)     
                            diffide = []
                            return false
                      }
                      
                   }
                     
          })
 }
 
  function printDiffide(objDiffide){
  console.log('printDiffide ')
  var $icon = $('#print-span')
              $icon.removeClass('glyphicon-print')
              $icon.addClass('glyphicon-refresh')
              $icon.addClass('glyphicon-refresh-animate')
      google.script.run
      .withSuccessHandler(onRetrievedDiffide)
      .withFailureHandler(onErrorPrinting)
      .retrieveDiffide(objDiffide)    
      return false
    }
      
      function onRetrievedDiffide(results){   
        console.log('diffide printed')
        var $icon = $('#print-span')
        $icon.removeClass('glyphicon-refresh')
        $icon.removeClass('glyphicon-refresh-animate')
        $icon.addClass('glyphicon-print')
        var outputMessage
        var resultDate = moment().format("DD/MM/YYYY h:mm:ss ")
        console.log(results[1])
        console.log(results[2])
           var resultMessage = (results[0] == 1) ? ' diffida correttamente stampata ':' diffide correttamente stampate ' 
           outputMessage = "<p> " + resultDate + " - " + results[0] + " " + resultMessage +  " sul seguente documento: \n" +  "<a href='" +results[1]+"' target='_blank'>" +results[2]+ "</a><br>"
           outputMessage += resultDate + "- Lista di controllo: <a href='" +results[3]+"' target='_blank'>" +results[4]+ "</a><br>"
           //aggiorna la tabella diffide
           createTableDiffide()
        $('#outputPanelText').append(outputMessage)
      }
      
      function onErrorPrinting(err){
        console.log(err)
        $('#outputPanelText').append('Non è stato possibile stampare le diffide selezionate: ' + err)
      }
 
 //********************************************************
 
  $('#insertExFlusso').on('click', function (e) {

      $('#exFlussoModal').modal('show');
      $('#formExFlusso').validator()
      $('#formExFlusso').on('submit', function(e){
         if (e.isDefaultPrevented()) {
               // se l'invio del form è stato prevenuto mostra un messaggio ed evita di eseguire le operazioni
               // che risulterebbero in più
               console.log('Il form inviato non è valido')
              
          } else {

         $('#exFlussoModal').modal('hide')
         var objExFlusso = $('#formExFlusso').serializeJSON()
         console.log(objExFlusso)
         sendExFlusso(objExFlusso)
         return false
       }
      }); 
      })

//*********************************************

//sendExFlusso - inserisce exFlusso

function sendExFlusso(objExFlusso){
console.log('sendExFlusso')
google.script.run
  .withSuccessHandler(onSentExFlusso)
  .withFailureHandler(onErrorExFlusso)
  .insertExFlusso(objExFlusso)
}

function onSentExFlusso(message){
    createTableDiffide()

}


  function onErrorExFlusso(message){
 
     console.log(message)
 
   }


//********************************************************************* 

  $('#export').on('click', function (e) {
     console.log('export Diffide')
      var objDiffide = {
        'Data esportazione':''}
      var diffide = []
      //var checkSinglesVisibleChecked = $("input.checkSingle:visible:checked");
      // var noExported = $(this).closest('tr').find('td').eq(9).html() 
      var $rows = $('#tableDiffide tr').not('thead tr')
      var noExported = $rows.filter(function() {
          return $rows.find('td').eq(9).html()=='Inviata';
      });
      
      console.log("noExported " + noExported.length)
      var now = moment(new Date()).format("DD/MM/YYYY")
      if (noExported.length == 0) {
        var outputMessage = now +': Non risultano pratiche da esportare.' 
        $('#outputPanelText').html(outputMessage)
        return false
      }
      
      $(noExported).each(function(){
            var parts = $(this).closest('tr').find('td').eq(2).html().split("/");
            var flusso = parts[parts.length - 1]; // Or parts.pop();
            if (flusso != "IOL"){
                var toExport = $(this).closest('tr').find('td').eq(1).html()
                diffide.push(toExport)
            }  
      });
      
      objDiffide.diffide = diffide.reverse() 
      var outputMessage = '<p>' + now +': Saranno esportate ' + (objDiffide.diffide).length + ' diffide</p>'
      $('#outputPanelText').html(outputMessage)
        var $icon = $('#export > span')
        $icon.removeClass('glyphicon-export')
        $icon.addClass('glyphicon-refresh glyphicon-refresh-animate')
        //$icon.addClass('glyphicon-refresh-animate')
      exportDiffide(objDiffide)
      })
 
 function exportDiffide(objDiffide){
  console.log('exportDiffide ')
      var $icon = $('#export > span')
        $icon.removeClass('glyphicon-export')
        $icon.addClass('glyphicon-refresh')
        $icon.addClass('glyphicon-refresh-animate')
      google.script.run
      .withSuccessHandler(onExportedDiffide)
      .withFailureHandler(onErrorExporting)
      .exportDiffide(objDiffide)    
      return false
    }
      
      function onExportedDiffide(results){   
         console.log(results)
        console.log('diffide exported')
        var $icon = $('#print')
        $icon.removeClass('glyphicon-refresh')
        $icon.removeClass('glyphicon-refresh-animate')
        $icon.addClass('glyphicon-export')
        var outputMessage
        var resultDate = moment().format("DD/MM/YYYY h:mm:ss ")

           var resultMessage = (results == 1) ? ' diffida correttamente esportata ':' diffide correttamente esportate ' 
           outputMessage = "<p>" + resultDate + ""
           outputMessage += resultMessage + "sui seguenti files:<br>" +  "<a href='" + results[1] + "' target='_blank'>Testata Pratiche</a><br>"
           outputMessage += "<a href='" +results[2]+"' target='_blank'>Recapiti</a><br>"
           outputMessage += "<a href='" +results[3]+"' target='_blank'>Lettere</a><br>"
           outputMessage += "<a href='" +results[4]+"' target='_blank'>Dettagli fatture</a><br>"
           //aggiorna la tabella diffide
           console.log(outputMessage)
        $('#outputPanelText').html(outputMessage)
      }
      
      function onErrorExporting(err){
        console.log(err)
        $('#outputPanelText').append('Si è verificato un errore in fase di esportazione delle diffide: ' + err)
      }
 
 
 //**********************************************************************
    $('#unDoLast').on('click', function (e) {
      var dates = []
      var colImportDate = $('#tableDiffide tr td:nth-child(10)') 
      var lastImport = Math.max.apply(Math, colImportDate.map(function(){
            var date = $(this).text()
            dates.push(date)
      return $(this).text()
      }))
      var lastImportDate = dates.reduce(function (a, b) { return a > b ? a : b; })
      $('#confirmModal').modal('show');
        $('#confirmOk').click(function(){
        console.log(lastImportDate)
        undoLastImport(lastImportDate)
        $('#confirmModal').modal('hide')
        });
      });              

   }) // close document ready function
    
//*************************************************************************************                


function createTableFiles(){
console.log('createTableFiles')
//legge i files affidi da importare presenti su folder
  google.script.run
    .withSuccessHandler(onImported)
    .withFailureHandler(onFailure)
    .readFilesAffidiFromFolder()
 }
 
 function onFailure(error) {
        var div = document.getElementById('outputPanelText');
        div.innerHTML = "ERROR: " + error.message;
 }
 
 function onImported(objFilesAffidi){
 var $icon = $('#refreshTableFiles')
       $icon.removeClass('glyphicon-refresh')
       $icon.removeClass('glyphicon-refresh-animate')
       $icon.addClass('glyphicon-repeat')
 var files = JSON.parse(objFilesAffidi)
 var myCheckbox = '' 
 var assegnati = 0
 var wroteOnTable = 0
 $('#tableFiles tbody').empty()
 if (files.length == 0) {
           $('#tableFiles thead').append('<th><td style="text-align: center" colspan="6">No result found</td></th>');        
 }
 else
 {
    for (var i=files.length-1; i>=0; i--){
        if (files[i]['Stato affido']){ //== 'Assegnato')
          assegnati++
          myCheckbox = '<label><input id="checkbox'+(i+1)+'" class="checkSingle" type="checkbox"></label>'
          tr = $('<tr>');
          tr.append("<td>" + myCheckbox + "</td>");
          tr.append("<td>" + files[i]['Nome del file'] + "</td>");
          tr.append("<td style='display: none'>" + files[i]['URL'] + "</td>");
          tr.append("<td>" + files[i]['Stato affido'] + "</td>");
          tr.append("<td>" + moment(files[i]['Data assegnazione']).format("DD/MM/YYYY hh:mm:ss ") + "</td>");
          if (files[i].Badge!='new') {
             
             if (files[i]['Data importazione']!='') {
              tr.append("<td>" + moment(files[i]['Data importazione']).format("DD/MM/YYYY hh:mm:ss ") + "</td>");
              }
              else
              {
              tr.append("<td></td>");
              }
             
          } 
          else
          {  tr.append("<td> <span class='label label-info'>" + files[i].Badge + "</span> </td>");
    
          }
          $('#tableFiles').append(tr);
          wroteOnTable++
        } 
    }
 }  
 
     $("#filesVisible").html(files.length)
     var checkSingleChecked = $(this).find(".checkSingle:checked")
     $("#filesChecked").html(checkSingleChecked.length)
          
     var resultDate = moment().format("dd/MM/YYYY hh:mm:ss ")
     switch(assegnati) {
     case 0:
     resultMessage = 'Non risultano files assegnati ancora da gestire.\n'
     break;
     case 1:
     resultMessage = 'Risulta ' + assegnati + ' file assegnato ancora da gestire.\n'
     break;
     default:
     resultMessage = 'Risultano ' + assegnati + ' files assegnati ancora da gestire.\n'
     break;
     }
        outputMessage = resultDate + ' - ' + resultMessage + '<br>'
        //$('#outputPanelText').append(outputMessage)
}


//********************************************************

// Crea la TableDiffide

function createTableDiffide(){  
//legge dati affidi e crea tabella diffide
console.log('createTableDiffide')
google.script.run
  .withSuccessHandler(onReadDiffideDaInviare)
  .withFailureHandler(onErrorImporting)
  .readDiffideDaInviareFromSheet()
}


// withSuccessHandler di readDiffideDaInviare

  function onReadDiffideDaInviare(objAllDiffideDaInviare){
    var $icon = $( '#refreshTableFiles >span')
      $icon.removeClass('glyphicon-refresh') 
      $icon.removeClass('glyphicon-refresh-animate') 
      $icon.addClass('glyphicon-repeat')
    var $icon = $( '#import')
      $icon.removeClass('glyphicon-refresh') 
      $icon.removeClass('glyphicon-refresh-animate') 
      $icon.addClass('glyphicon-import')   
    var diffide = JSON.parse(objAllDiffideDaInviare)
    console.log('DiffideDaInviare ')
    $('#tableDiffide tbody').remove()
        var tr
        if (diffide.length > 0){
          for (i=diffide.length-1; i>=0; i--){
          
                var myCheckbox = '<div vcenter> <label> <input class="checkSingle" type="checkbox"> </label> </div>'
                tr = $('<tr>');
                tr.append("<td >" + myCheckbox + "</td>");
                tr.append("<td id='idDiffida' >" + diffide[i]['ID diffida'] + "</td>");
                tr.append("<td >" + diffide[i]['Riferimento pratica']+"/"+diffide[i]['Tipologia flusso'] + "</td>");
                
                // crea badge nella colonna solo per pratiche ex-flusso
                if ( diffide[i]['Tipologia pratica'] == 'OPPOSIZIONE' || diffide[i]['Tipologia pratica'] == 'FALLIMENTO' || diffide[i]['Tipologia pratica'] == 'CONCORDATO'){ 
                    tr.append("<td ><span class='label label-warning'>" + diffide[i]['Tipologia pratica'] +"</span></td>");
                }else
                {
                    tr.append("<td ></td>")
                }
                    tr.append("<td >" + diffide[i]['Nome file affido'] + "</td>");
                    tr.append("<td >" + diffide[i]['Codice cliente'] + "</td>");
                    tr.append("<td >" + diffide[i]['Partita IVA'] + "</td>");
                    tr.append("<td >" + diffide[i]['Codice fiscale'] + "</td>");
                    tr.append("<td >" + diffide[i]['Ragione sociale'] + "</td>");
                    tr.append("<td >" + diffide[i]['Stato'] + "</td>");
                    tr.append("<td >" + moment(diffide[i]['Data importazione']).format("DD/MM/YYYY hh:mm:ss ") + "</td>");
                    //tr.append("<td >" + diffide[i]['Data importazione'] + "</td>")
                    
                if (diffide[i]['Data stampa']!='') {
                          tr.append("<td>" + moment(diffide[i]['Data stampa']).format("DD/MM/YYYY hh:mm:ss ") + "</td>");
                }
                else
                {
                     tr.append("<td></td>");
                }
                if (diffide[i]['Data esportazione']!='') {
                     console.log(diffide[i]['Data esportazione'])
                     tr.append("<td>" + moment(diffide[i]['Data esportazione']).format("DD/MM/YYYY hh:mm:ss") + "</td>");
                }
                else
                {
                     tr.append("<td></td>");
                }
                
                 if (diffide[i]['Data invio']!='') {
                     tr.append("<td >" + moment(diffide[i]['Data invio']).format("DD/MM/YYYY") + "</td>");
                }
                else
                {
                     tr.append("<td></td>");
                }
                 
               
                $('#tableDiffide').append(tr);  
          }
          console.log('table diffide created')
          $("#praticheVisible").html(diffide.length)
          var checkSingleChecked = $(this).find(".checkSingle:checked")
          $("#praticheChecked").html(checkSingleChecked.length)
          var colImportDate = $('#tableDiffide tr td:nth-child(9)')        
          var high = Math.max.apply(Math, colImportDate.map(function(){
             var date = $(this).text()
             return $(this).text()
           }))
        }
        else
        {
           $('#tableDiffide tbody').prepend($('<tr class="no-result text-center"><td colspan="">No result found</td></tr>'));
        }
 }


function onErrorImporting(err){
     console.log(err)
}


//**************************
//unDoLastImport - cancella l'ultima importazione

function undoLastImport(lastImportDate){

console.log('undoLastImport')
//legge i files affidi da importare presenti su folder
  google.script.run
    .withSuccessHandler(onUndoSuccess)
    .withFailureHandler(onFailure)
    .deleteLastImportedDiffide(lastImportDate)
 }
 
// function onFailure(error) {
//        var div = document.getElementById('outputPanelText');
//        div.innerHTML = "ERROR: " + error.message;
// }
// 
 function onUndoSuccess(message){
 
 console.log(message)
 
 }
 

</script>


